<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Varnam Suite ‚Äî {{ title }}</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#0B0F1A;--surface:#141926;--border:#2A3148;--text:#E8ECF4;--text2:#8B95B0;--blue:#3B82F6;--green:#4ADE80;--red:#F87171;--orange:#FBBF24;--purple:#A78BFA}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
.topbar{background:var(--surface);border-bottom:1px solid var(--border);padding:12px 24px;display:flex;align-items:center;justify-content:space-between}
.topbar h1{font-size:20px;font-weight:800;color:#fff}.topbar h1 span{background:linear-gradient(135deg,var(--blue),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.topbar-right{display:flex;gap:8px;align-items:center}
.topbar-right a{font-size:13px;color:var(--text2);text-decoration:none;padding:7px 12px;border-radius:8px}.topbar-right a:hover{background:var(--border)}
.topbar-right a.open-app{background:linear-gradient(135deg,var(--blue),var(--purple));color:#fff;font-weight:600}
.main{max-width:1100px;margin:0 auto;padding:24px}
h2{font-size:22px;font-weight:800;color:#fff;margin-bottom:2px}
.count{font-size:14px;color:var(--text2);margin-bottom:20px}
.summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:24px}
.sc{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center}
.sc .sl{font-size:11px;font-weight:700;text-transform:uppercase;color:var(--text2);margin-bottom:4px}
.sc .sv{font-size:20px;font-weight:800;color:#fff}
.sc .sv.g{color:var(--green)}.sc .sv.r{color:var(--red)}.sc .sv.o{color:var(--orange)}.sc .sv.b{color:var(--blue)}
.card{background:var(--surface);border:1px solid var(--border);border-radius:14px;overflow:hidden}
table{width:100%;border-collapse:collapse}
th{padding:12px 16px;text-align:left;font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;background:var(--bg);border-bottom:1px solid var(--border)}
td{padding:12px 16px;font-size:13px;color:var(--text);border-bottom:1px solid var(--border)}
tr:hover{background:rgba(59,130,246,.05)}
.status{display:inline-block;padding:3px 8px;border-radius:10px;font-size:11px;font-weight:700}
.status.paid,.status.active,.status.completed,.status.accepted{background:rgba(74,222,128,.15);color:var(--green)}
.status.sent,.status.signed{background:rgba(59,130,246,.15);color:var(--blue)}
.status.draft{background:rgba(139,149,176,.12);color:var(--text2)}
.status.overdue,.status.cancelled{background:rgba(248,113,113,.15);color:var(--red)}
.amt{font-weight:700;font-variant-numeric:tabular-nums}
.amt.g{color:var(--green)}.amt.r{color:var(--red)}.amt.o{color:var(--orange)}
.empty{text-align:center;padding:40px;color:var(--text2);font-size:14px}
.co-tag{font-size:11px;color:var(--text2);background:var(--bg);padding:2px 6px;border-radius:4px}
</style>
</head>
<body>
<div class="topbar">
    <a href="/apps" style="text-decoration:none"><h1>Snap<span>Suite</span></h1></a>
    <div class="topbar-right">
        <a href="/?company={{ company.id }}">‚Üê Dashboard</a>
        <a href="/export/{{ app_name }}?company={{ company.id }}" class="open-app" style="background:linear-gradient(135deg,#4ADE80,#14b8a6)">üì• Export Excel</a>
        {% if app_url %}<a href="{{ app_url }}" target="_blank" class="open-app">Open {{ title }} App ‚Üó</a>{% endif %}
    </div>
</div>
<div class="main">
    <h2>{{ company.name }} ‚Äî {{ title }}</h2>
    <p class="count">{{ data|length }} record{{ 's' if data|length != 1 else '' }}</p>

    {% if app_name == 'invoices' %}
    {% set total = data|map(attribute='total')|map('float')|sum %}
    {% set paid = data|selectattr('status','eq','paid')|map(attribute='total')|map('float')|sum %}
    <div class="summary">
        <div class="sc"><div class="sl">Invoiced</div><div class="sv">{{ curr }}{{ "{:,.0f}".format(total) }}</div></div>
        <div class="sc"><div class="sl">Paid</div><div class="sv g">{{ curr }}{{ "{:,.0f}".format(paid) }}</div></div>
        <div class="sc"><div class="sl">Outstanding</div><div class="sv o">{{ curr }}{{ "{:,.0f}".format(total-paid) }}</div></div>
    </div>
    <div class="card"><table><thead><tr><th>Invoice</th><th>Client</th><th>Date</th><th>Total</th><th>Status</th></tr></thead><tbody>
    {% for i in data %}<tr><td><strong>{{ i.invoice_number or '-' }}</strong></td><td>{{ i.client_name or '-' }}</td><td>{{ i.date or '-' }}</td><td class="amt">{{ curr }}{{ "{:,.0f}".format(i.total or 0) }}</td><td><span class="status {{ i.status or 'draft' }}">{{ (i.status or 'draft')|capitalize }}</span></td></tr>{% endfor %}
    {% if not data %}<tr><td colspan="5" class="empty">No invoices</td></tr>{% endif %}
    </tbody></table></div>

    {% elif app_name == 'contracts' %}
    {% set tv = data|map(attribute='total_value')|map('float')|sum %}
    <div class="summary">
        <div class="sc"><div class="sl">Total Value</div><div class="sv b">{{ curr }}{{ "{:,.0f}".format(tv) }}</div></div>
        <div class="sc"><div class="sl">Count</div><div class="sv">{{ data|length }}</div></div>
    </div>
    <div class="card"><table><thead><tr><th>Ref</th><th>Title</th><th>Client</th><th>Value</th><th>Status</th></tr></thead><tbody>
    {% for c in data %}<tr><td><strong>{{ c.contract_number }}</strong></td><td>{{ c.title or '-' }}</td><td>{{ c.client_name or '-' }}</td><td class="amt">{{ curr }}{{ "{:,.0f}".format(c.total_value or 0) }}</td><td><span class="status {{ c.status or 'draft' }}">{{ (c.status or 'draft')|capitalize }}</span></td></tr>{% endfor %}
    {% if not data %}<tr><td colspan="5" class="empty">No contracts</td></tr>{% endif %}
    </tbody></table></div>

    {% elif app_name == 'expenses' %}
    <div class="card"><table><thead><tr><th>Date</th><th>Vendor</th><th>Category</th><th>Company</th><th>Total</th></tr></thead><tbody>
    {% for e in data %}<tr><td>{{ e.date or e.receipt_date or '-' }}</td><td><strong>{{ e.vendor or e.merchant or '-' }}</strong></td><td>{{ e.category or '-' }}</td><td>{% if e.company_name %}<span class="co-tag">{{ e.company_name }}</span>{% endif %}</td><td class="amt r">{{ e.currency or '' }} {{ "{:,.2f}".format(e.total or e.amount or 0) }}</td></tr>{% endfor %}
    {% if not data %}<tr><td colspan="5" class="empty">No expenses</td></tr>{% endif %}
    </tbody></table></div>

    {% elif app_name == 'payroll' %}
    {% set tg = namespace(v=0) %}{% set tn = namespace(v=0) %}
    {% for p in data %}{% set tg.v = tg.v + (p.gross_earnings or 0)|float %}{% set tn.v = tn.v + (p.net_pay or 0)|float %}{% endfor %}
    <div class="summary">
        <div class="sc"><div class="sl">Gross</div><div class="sv">{{ curr }}{{ "{:,.0f}".format(tg.v) }}</div></div>
        <div class="sc"><div class="sl">Net Payout</div><div class="sv g">{{ curr }}{{ "{:,.0f}".format(tn.v) }}</div></div>
        <div class="sc"><div class="sl">Deductions</div><div class="sv o">{{ curr }}{{ "{:,.0f}".format(tg.v - tn.v) }}</div></div>
    </div>
    <div class="card"><table><thead><tr><th>Employee</th><th>Period</th><th>Gross</th><th>Deductions</th><th>Net</th></tr></thead><tbody>
    {% for p in data %}<tr><td><strong>{{ p.emp_name or p.employee_name or '-' }}</strong></td><td>{{ p.month or '-' }}/{{ p.year or '-' }}</td><td class="amt">{{ curr }}{{ "{:,.0f}".format(p.gross_earnings or 0) }}</td><td class="amt o">{{ curr }}{{ "{:,.0f}".format(p.total_deductions or 0) }}</td><td class="amt g">{{ curr }}{{ "{:,.0f}".format(p.net_pay or 0) }}</td></tr>{% endfor %}
    {% if not data %}<tr><td colspan="5" class="empty">No payslips</td></tr>{% endif %}
    </tbody></table></div>

    {% elif app_name == 'proposals' %}
    {% set tv = namespace(v=0) %}
    {% for p in data %}{% set tv.v = tv.v + (p.value or 0)|float %}{% endfor %}
    <div class="summary">
        <div class="sc"><div class="sl">Total Pipeline</div><div class="sv b">{{ curr }}{{ "{:,.0f}".format(tv.v) }}</div></div>
        <div class="sc"><div class="sl">Sent</div><div class="sv">{{ data|selectattr('status','eq','sent')|list|length }}</div></div>
        <div class="sc"><div class="sl">Accepted</div><div class="sv g">{{ data|selectattr('status','eq','accepted')|list|length }}</div></div>
        <div class="sc"><div class="sl">Draft</div><div class="sv">{{ data|selectattr('status','eq','draft')|list|length }}</div></div>
    </div>
    {% for p in data %}
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;margin-bottom:14px">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px">
            <div>
                <h3 style="font-size:18px;font-weight:800;color:#fff;margin-bottom:4px">{{ p.title }}</h3>
                <span style="font-size:13px;color:var(--text2)">Client: <strong style="color:var(--text)">{{ p.client }}</strong> &nbsp;¬∑&nbsp; {{ p.created }}</span>
            </div>
            <div style="text-align:right">
                <div style="font-size:20px;font-weight:800;color:#fff;margin-bottom:4px">{{ curr }}{{ "{:,.0f}".format(p.value or 0) }}</div>
                <span class="status {{ p.status }}">{{ p.status|capitalize }}</span>
            </div>
        </div>
        <p style="font-size:14px;color:var(--text2);line-height:1.7;margin-bottom:12px">{{ p.description }}</p>
        <div style="display:flex;gap:16px;align-items:center">
            <span style="font-size:12px;color:var(--text2);background:var(--bg);padding:4px 10px;border-radius:6px">üìÑ {{ p.slides }} slides</span>
            <a href="{{ app_url }}/demo" target="_blank" style="font-size:12px;color:var(--blue);text-decoration:none;font-weight:700">View in ProposalSnap ‚Üí</a>
        </div>
    </div>
    {% endfor %}
    {% if not data %}<div class="empty">No proposals yet ‚Äî <a href="{{ app_url }}" target="_blank" style="color:var(--blue)">create one in ProposalSnap</a></div>{% endif %}
    {% endif %}
</div>
</body></html>
