<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>SnapSuite ‚Äî Admin</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#0B0F1A;--surface:#141926;--border:#2A3148;--text:#E8ECF4;--text2:#8B95B0;--blue:#3B82F6;--green:#4ADE80;--red:#F87171;--orange:#FBBF24;--purple:#A78BFA}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
.topbar{background:var(--surface);border-bottom:1px solid var(--border);padding:12px 24px;display:flex;align-items:center;justify-content:space-between}
.topbar h1{font-size:20px;font-weight:800;color:#fff}.topbar h1 span{background:linear-gradient(135deg,var(--blue),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.topbar-right a{font-size:13px;color:var(--text2);text-decoration:none;padding:7px 12px;border-radius:8px}.topbar-right a:hover{background:var(--border);color:#fff}
.main{max-width:1200px;margin:0 auto;padding:24px}
h2{font-size:22px;font-weight:800;color:#fff;margin-bottom:4px}
.subtitle{font-size:14px;color:var(--text2);margin-bottom:24px}
.totals{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:28px}
.tot{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;text-align:center}
.tot .tl{font-size:11px;font-weight:700;text-transform:uppercase;color:var(--text2);letter-spacing:.5px;margin-bottom:4px}
.tot .tv{font-size:22px;font-weight:800;color:#fff}
.tot .tv.g{color:var(--green)}.tot .tv.r{color:var(--red)}.tot .tv.o{color:var(--orange)}.tot .tv.b{color:var(--blue)}
/* Company cards */
.cc{background:var(--surface);border:1px solid var(--border);border-radius:14px;margin-bottom:14px;overflow:hidden;cursor:pointer;transition:.15s}
.cc:hover{border-color:var(--blue)}
.cc-head{padding:18px 22px;display:flex;justify-content:space-between;align-items:center}
.cc-head .name{font-size:16px;font-weight:700;color:#fff}
.cc-head .meta{font-size:12px;color:var(--text2);margin-top:2px}
.cc-head .right{text-align:right}
.cc-head .profit{font-size:20px;font-weight:800}
.cc-head .profit.g{color:var(--green)}.cc-head .profit.r{color:var(--red)}
.cc-head .apps-dots{display:flex;gap:4px;justify-content:flex-end;margin-top:4px}
.adot{width:8px;height:8px;border-radius:50%}
.adot.on{background:var(--green)}.adot.off{background:var(--border)}
.cc-body{display:none;padding:0 22px 18px;border-top:1px solid var(--border)}
.cc-body.open{display:block;padding-top:14px}
.app-badges{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px}
.ab{padding:4px 10px;border-radius:6px;font-size:11px;font-weight:700}
.ab.on{background:rgba(74,222,128,.1);color:var(--green);border:1px solid rgba(74,222,128,.2)}
.ab.off{background:var(--bg);color:var(--text2);border:1px solid var(--border)}
.metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.met{background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:12px}
.met .ml{font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;margin-bottom:4px}
.met .mv{font-size:16px;font-weight:800;color:var(--text)}
</style>
</head>
<body>
<div class="topbar">
    <h1>Snap<span>Suite</span></h1>
    <div class="topbar-right"><a href="/">‚Üê Dashboard</a><a href="/diagnose">üîç Diagnose</a><a href="/logout">Sign out</a></div>
</div>
<div class="main">
    <h2>üëë Platform Admin</h2>
    <p class="subtitle">{{ totals.companies }} companies across SnapSuite (max {{ 20 }})
        <form method="POST" action="/sync" style="display:inline;margin-left:12px"><button type="submit" style="padding:6px 16px;background:linear-gradient(135deg,var(--blue),var(--purple));color:#fff;border:none;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif">üîÑ Sync All Apps</button></form>
        <a href="/diagnose" style="display:inline-block;margin-left:8px;padding:6px 16px;border:1px solid var(--border);border-radius:8px;font-size:12px;font-weight:600;color:var(--text2);text-decoration:none">üîç Diagnose</a>
    </p>

    <div class="totals">
        <div class="tot"><div class="tl">Companies</div><div class="tv">{{ totals.companies }}</div></div>
        <div class="tot"><div class="tl">Contract Value</div><div class="tv b">{{ "{:,.0f}".format(totals.contracts) }}</div></div>
        <div class="tot"><div class="tl">Invoiced</div><div class="tv">{{ "{:,.0f}".format(totals.invoiced) }}</div></div>
        <div class="tot"><div class="tl">Revenue</div><div class="tv g">{{ "{:,.0f}".format(totals.paid) }}</div></div>
        <div class="tot"><div class="tl">Expenses</div><div class="tv r">{{ "{:,.0f}".format(totals.expenses) }}</div></div>
        <div class="tot"><div class="tl">Profit</div><div class="tv {{ 'g' if totals.profit >= 0 else 'r' }}">{{ "{:,.0f}".format(totals.profit) }}</div></div>
    </div>

    {% for c in companies %}
    {% set s = summaries.get(c.id, {}) %}
    {% set apps = s.get('apps', {}) %}
    <div class="cc" onclick="this.querySelector('.cc-body').classList.toggle('open')">
        <div class="cc-head">
            <div>
                <div class="name">{{ c.name }}</div>
                <div class="meta">{{ c.owner_email or 'No owner' }} ¬∑ {{ c.currency }} ¬∑ {{ c.created_at.strftime('%b %d, %Y') if c.created_at else '' }}</div>
            </div>
            <div class="right">
                <div class="profit {{ 'g' if s.profit >= 0 else 'r' }}">{{ cs(c.currency) }}{{ "{:,.0f}".format(s.profit) }}</div>
                <div class="apps-dots">
                    <div class="adot {{ 'on' if 'ProposalSnap' in apps else 'off' }}" title="ProposalSnap"></div>
                    <div class="adot {{ 'on' if 'ContractSnap' in apps else 'off' }}" title="ContractSnap"></div>
                    <div class="adot {{ 'on' if 'InvoiceSnap' in apps else 'off' }}" title="InvoiceSnap"></div>
                    <div class="adot {{ 'on' if 'ExpenseSnap' in apps else 'off' }}" title="ExpenseSnap"></div>
                    <div class="adot {{ 'on' if 'PayslipSnap' in apps else 'off' }}" title="PayslipSnap"></div>
                </div>
            </div>
        </div>
        <div class="cc-body">
            <div class="app-badges">
                {% for an in ['ProposalSnap','ContractSnap','InvoiceSnap','ExpenseSnap','PayslipSnap'] %}
                <span class="ab {{ 'on' if an in apps else 'off' }}">{{ '‚úì' if an in apps else '‚úó' }} {{ an }}</span>
                {% endfor %}
            </div>
            <div class="metrics">
                <div class="met"><div class="ml">Contracts</div><div class="mv">{{ cs(c.currency) }}{{ "{:,.0f}".format(s.contracts) }}</div></div>
                <div class="met"><div class="ml">Invoiced</div><div class="mv">{{ cs(c.currency) }}{{ "{:,.0f}".format(s.invoiced) }}</div></div>
                <div class="met"><div class="ml">Expenses</div><div class="mv">{{ cs(c.currency) }}{{ "{:,.0f}".format(s.expenses) }}</div></div>
                <div class="met"><div class="ml">Payroll</div><div class="mv">{{ cs(c.currency) }}{{ "{:,.0f}".format(s.payroll) }}</div></div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
</body></html>
