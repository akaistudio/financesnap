<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanceSnap ‚Äî Companies</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh}
        .topbar{background:#1e293b;border-bottom:1px solid #334155;padding:14px 24px;display:flex;align-items:center;justify-content:space-between}
        .topbar h1{font-size:20px;font-weight:800;color:#fff}.topbar h1 span{background:linear-gradient(135deg,#60a5fa,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .topbar-right a{font-size:13px;color:#cbd5e1;text-decoration:none;padding:7px 12px;border-radius:8px}.topbar-right a:hover{background:#334155}
        .main{max-width:900px;margin:0 auto;padding:24px}
        h2{font-size:24px;font-weight:800;color:#fff;margin-bottom:4px}
        .subtitle{font-size:14px;color:#94a3b8;margin-bottom:24px}
        .flash{padding:12px 16px;border-radius:10px;font-size:14px;margin-bottom:16px}
        .flash.success{background:rgba(74,222,128,.1);color:#4ade80;border:1px solid rgba(74,222,128,.25)}
        .flash.error{background:rgba(248,113,113,.1);color:#f87171;border:1px solid rgba(248,113,113,.25)}

        .card{background:#1e293b;border:1px solid #475569;border-radius:14px;padding:22px;margin-bottom:20px}
        .card h3{font-size:15px;font-weight:700;color:#cbd5e1;margin-bottom:16px}

        /* Sync button */
        .sync-bar{display:flex;gap:12px;margin-bottom:24px}
        .btn{padding:10px 20px;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:13px;font-family:'Inter',sans-serif;transition:.2s}
        .btn-primary{background:linear-gradient(135deg,#3b82f6,#8b5cf6);color:#fff}.btn-primary:hover{opacity:.9}
        .btn-green{background:#16a34a;color:#fff}.btn-green:hover{background:#15803d}
        .btn-red{background:transparent;color:#f87171;border:1px solid #f87171;padding:6px 12px;font-size:12px}.btn-red:hover{background:rgba(248,113,113,.1)}

        /* Company cards */
        .company-card{background:#0f172a;border:1px solid #334155;border-radius:12px;padding:18px;margin-bottom:14px;display:flex;align-items:center;justify-content:space-between}
        .company-card:hover{border-color:#475569}
        .cc-left h4{font-size:16px;font-weight:700;color:#fff;margin-bottom:4px}
        .cc-left .mappings{font-size:12px;color:#94a3b8;display:flex;gap:12px;flex-wrap:wrap;margin-top:6px}
        .cc-left .mappings span{background:#1e293b;padding:3px 8px;border-radius:4px}
        .cc-left .mappings .active{color:#4ade80;border:1px solid rgba(74,222,128,.3)}
        .cc-left .mappings .inactive{color:#64748b;border:1px solid #334155}
        .cc-right{display:flex;align-items:center;gap:12px}
        .curr-badge{padding:5px 12px;background:#1e293b;border:1px solid #475569;border-radius:6px;font-size:13px;font-weight:700;color:#fbbf24}

        /* Add form */
        .add-form{display:grid;grid-template-columns:1fr;gap:14px}
        .form-row{display:grid;grid-template-columns:1fr 100px;gap:12px}
        .form-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
        label{font-size:12px;font-weight:700;color:#94a3b8;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;display:block}
        input,select{width:100%;padding:10px 12px;border:1.5px solid #334155;border-radius:8px;background:#0f172a;color:#fff;font-size:14px;font-family:'Inter',sans-serif}
        input:focus,select:focus{outline:none;border-color:#60a5fa}
        .hint{font-size:11px;color:#64748b;margin-top:4px}
    </style>
</head>
<body>
<div class="topbar">
    <h1>Finance<span>Snap</span></h1>
    <div class="topbar-right"><a href="/">‚Üê Dashboard</a></div>
</div>
<div class="main">
    {% with messages = get_flashed_messages(with_categories=true) %}{% for cat, msg in messages %}<div class="flash {{ cat }}">{{ msg }}</div>{% endfor %}{% endwith %}

    <h2>üè¢ Companies</h2>
    <p class="subtitle">Each company maps to accounts across your SnapSuite apps. Switch between them on the dashboard.</p>

    <!-- Sync from ExpenseSnap -->
    <div class="sync-bar">
        <form method="POST" action="/companies/sync"><button type="submit" class="btn btn-primary">üîÑ Auto-Import from ExpenseSnap</button></form>
    </div>

    <!-- Existing Companies -->
    {% if companies %}
    {% for c in companies %}
    <div class="company-card">
        <div class="cc-left">
            <h4>{{ c.name }}</h4>
            <div class="mappings">
                <span class="{{ 'active' if c.expense_company_id else 'inactive' }}">ExpenseSnap: {{ 'Linked' if c.expense_company_id else 'Not linked' }}</span>
                <span class="{{ 'active' if c.invoice_company_name else 'inactive' }}">InvoiceSnap: {{ c.invoice_company_name or 'Not set' }}</span>
                <span class="{{ 'active' if c.contract_company_name else 'inactive' }}">ContractSnap: {{ c.contract_company_name or 'Not set' }}</span>
                <span class="{{ 'active' if c.payslip_company_name else 'inactive' }}">PayslipSnap: {{ c.payslip_company_name or 'Not set' }}</span>
            </div>
        </div>
        <div class="cc-right">
            <span class="curr-badge">{{ c.currency }}</span>
            <form method="POST" action="/companies/{{ c.id }}/delete" onsubmit="return confirm('Delete {{ c.name }}?')">
                <button type="submit" class="btn-red">Delete</button>
            </form>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="card"><div style="text-align:center;padding:24px;color:#64748b">No companies yet. Add one below or auto-import from ExpenseSnap.</div></div>
    {% endif %}

    <!-- Add Company -->
    <div class="card" style="margin-top:24px">
        <h3>‚ûï Add Company</h3>
        <form method="POST" action="/companies/add" class="add-form">
            <div class="form-row">
                <div>
                    <label>Company Name</label>
                    <input type="text" name="name" required placeholder="e.g. Varnam, Shakty.AI">
                </div>
                <div>
                    <label>Currency</label>
                    <select name="currency">
                        <option value="INR">INR ‚Çπ</option>
                        <option value="USD">USD $</option>
                        <option value="EUR">EUR ‚Ç¨</option>
                        <option value="GBP">GBP ¬£</option>
                        <option value="CAD">CAD $</option>
                    </select>
                </div>
            </div>

            <div>
                <label>ExpenseSnap Company</label>
                <select name="expense_company_id">
                    <option value="">‚Äî None ‚Äî</option>
                    {% for ec in ext_companies %}
                    <option value="{{ ec.id }}">{{ ec.name }} ({{ ec.home_currency or 'USD' }})</option>
                    {% endfor %}
                </select>
                <div class="hint">Links this company to an ExpenseSnap company for expense data</div>
            </div>

            <div class="form-row-3">
                <div>
                    <label>InvoiceSnap Company Name</label>
                    <input type="text" name="invoice_company_name" placeholder="Company name used in InvoiceSnap">
                    <div class="hint">Match company_name in invoices</div>
                </div>
                <div>
                    <label>ContractSnap Company Name</label>
                    <input type="text" name="contract_company_name" placeholder="Company name in ContractSnap">
                </div>
                <div>
                    <label>PayslipSnap Company Name</label>
                    <input type="text" name="payslip_company_name" placeholder="Company name in PayslipSnap">
                </div>
            </div>

            <button type="submit" class="btn btn-green">Add Company</button>
        </form>
    </div>
</div>
</body></html>
